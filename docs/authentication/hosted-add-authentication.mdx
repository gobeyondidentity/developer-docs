---
title: Add authentication
id: hosted-add-authentication
description: ""
slug: /hosted-add-authentication
keywords:
  - scenario
pagination_next: null
pagination_prev: null
last_update:
  date: 08/07/2023
  author: Anna Garcia
draft: false
hide_table_of_contents: false
hide_title: false
hide_breadcrumbs: false
doc_type: quickstart
displayed_sidebar: mainSidebar
---

import ProtocolOIDC from '../includes/_protocol_oidc.mdx';
import PKCES256 from '../includes/_pkce_s256.mdx';
import HostedWeb from '../includes/_hosted-web.mdx';
import ClientTypeConfidential from '../includes/_client-type_confidential.mdx';
import GrantTypeAuthorizationCode from '../includes/_grant-type_authorization-code.mdx';
import TokenEndpointAuthMethodClientSecretBasic from '../includes/_token-endpoint-auth-method_client-secret-basic.mdx';


**Hosted Web** is one of two Configuration Types in the Authenticator Config tab that can be configured when [creating an application](/docs/next/add-an-application). Selecting this option requires less configuration and code, but it does require redirecting your users to a web-based authenticator hosted by Beyond Identity.

The Hosted Web Authenticator handles passkey registration and authentication for you, including generating new passkeys, presenting users with authenticator choice options and validating passkey assertions. Your app simply needs to redirect to Beyond Identity's hosted web authenticator, and we do the rest. 

The Hosted Web Authenticator can be set up using an OpenID Connect or OAuth2 client library. Many frameworks and languages have their own. If you wish to find an OpenID Connect client, we recommend looking for one on the list of [certified OpenID Connect clients](https://openid.net/developers/certified/) under **Certified Relying Party Libraries**.

## Overview

With this guide you will:

1. Create a Beyond Identity application using the Hosted Web Authenticator
1. Use on OAuth2/OIDC `/authorize` call to initiate passkey based authentication with Beyond Identity
1. Consume the resulting code and token(s)

## Create your Beyond Identity application

### Prerequisites

- [x] If you haven't already created your Beyond Identity tenant, set up a [developer account](https://www.beyondidentity.com/developers).
- [x] Once you have your tenant, go ahead and log in.  

You can access the Beyond Identity admin console for your tenant at [BI admin console US](https://console-us.beyondidentity.com/login) or [BI admin console EU](https://console-eu.beyondidentity.com/login), depending on the region you chose when you signed up.  

:::tip  
_If you are signing in from a different computer or browser, you can enter the ema
address you used when you signed up. Beyond Identity will send you a one time li
you can use to sign in and enroll a passkey from the new browser._  
:::

### Create a new realm

So far, you have the Beyond Identity Admin Realm for your Beyond Identity tenant only. In this step, you'll create a new Realm to hold your users' identities and the configuration. 

import CreateRealmConsole from '../includes/_create-realm-console.mdx';

<CreateRealmConsole />

### Create an application

In this step, you'll create a new Application containing the configuration for your users.

import AddAppAdminConsole from '../includes/_add-application-console.mdx';

<AddAppAdminConsole />

On the **External Protocol** tab, use the following values to complete this tab.

  | Property | Value |
  | --- | --- |
  | **Display Name** | Descriptive name you choose |
  | **Protocol** | OIDC<br /><ProtocolOIDC/> |
  | **Client Type** | Confidential<br /><ClientTypeConfidential/> |
  | **PKCE** | S256<br /><PKCES256/> |
  | **Redirect URIs** | Use your application's App Scheme or Universal URL.<br /><br />If you are using an OAuth or OpenID Connect client library, a redirect URI may be specefied for you. <br /><br />For example: In a Next.js application using NextAuth, your redirect URI follows the pattern:<br /><br /><pre>http://localhost:3000/api/auth/callback/beyondidentity</pre><div class= "note-message note-message-table"><p>where `beyondidentity` in this URI is the ID of the OAuth provider as configured in the providers array in NextAuth.js and `/api/auth/callback/` is based on the Next.js route file structure.</p></div> |
  | **Token Endpoint Auth Method** | Client Secret Basic<br /><TokenEndpointAuthMethodClientSecretBasic/> |
  | **Grant Type** | Authorization Code<br /><GrantTypeAuthorizationCode/> |
  | **All other options** | Use the default values for the remaining options |

On the **Authenticator Config** tab, use the following values to complete this tab.

   | Property | Value | 
   | ----------- | ----------- |
   | **Configuration Type** | Hosted Web <br /><HostedWeb/> |
   | **Authentication Profile** | Use the default values for the remaining options |


### Configure your app for OAuth/OIDC calls to Beyond Identity


### Using your own app

You can add Beyond Identity to any web app using OAuth/OIDC. 

The example below shows a standard confidential client using the authorization code flow with PKCE. 

Find more examples in the [Create an Access Token](/docs/next/create-api-token) guide.  


import AccessTokenCreateConfClientPkce from "../includes/_access_token_create_conf_client_pkce.mdx";

<AccessTokenCreateConfClientPkce />

## Create users and passkeys

Because you created an app with the 'Hosted Web' authentication configuration type, you are ready to test without writing any more authentication code.  

But you'll need a user with an enrolled passkey first, which you can create via the [Beyond Identity API](https://developer.beyondidentity.com/api/v1).  

:::note

If you wish to create identities and passkey via the Admin Console, you can do so following the guidance here:

- [Add an identity](/docs/next/add-an-identity)
- [Add a passkey](/docs/next/add-passkey)

:::

### Create one or more identities in your Beyond Identity app's realm

You can create an identity using the [Beyond Identity API](https://developer.beyondidentity.com/api/v1#tag/Identities/operation/CreateIdentity).

Create the HTTP request with the following properties:  

**Request url:**  

```http
https://api-{us|eu}.beyondidentity.com/v1/tenants/{tenant_id}/realms/{realm_id}/identities
```

**Request method:** POST  

**Request headers:**  

```http
Authorization: Bearer {bi_api_token}
content-type: application/x-www-form-urlencoded  
```

where {bi_api_token} is an [API token you create for the Beyond Identity API](/docs/next/create-api-token#create-an-access-token-in-the-console), containing the scope `identities:create` at minimum.  

**Request body:**  

```json
{
"identity": {
  "display_name": "{display_name}",
  "traits": {
    "type": "traits_v0",
    "username": "{username}",
    "primary_email_address": "{email_address}"
    }
  }
}
```

where:  
- \{display_name\} is a string containing any name you wish

- \{username\} is a string containing a unique, case insensitive username for the identity

- \{email_address\} is set to an address where you can receive email in the format 'user@example.com'

The response JSON will contain the **id** of the new identity, which you'll use in the next call to create the passkey binding.

### Create passkeys for your identities

Once you've created the identity via the request above, you'll need to enroll a passkey for the new user. For this, you'll use the email enrollment flow. Double check that you created the identity above using an {email_address} that is a real address where you can receive email.  

Create the HTTP request with the following properties:  

**Request url:**  

```http
https://api-{us|eu}.beyondidentity.com/v1/tenants/{tenant_id}/realms/{realm_id}/identities/{identity_id}/credential-binding-jobs
```

where {identity_id} is the **id** returned in the response JSON from the create identity API call above.  

**Request method:** POST  

**Request headers:**  

```http
Authorization: Bearer {bi_api_token}
content-type: application/x-www-form-urlencoded  
```

where {bi_api_token} is an [API token you create for the Beyond Identity API](/docs/next/create-api-token#create-an-access-token-in-the-console), containing the scope `credential-binding-jobs:create` at minimum.  

**Request body:**  

```json
{ 
  "job": { 
    "delivery_method": "EMAIL", 
    "authenticator_config_id": "{your app's AUTHENTICATOR_CONFIG_ID}", 
    "post_binding_redirect_uri": "http://localhost:{your_app's_port}"
  }
}  
```

### Example (node.js)

```javascript
return fetch(
  `https://api-us.beyondidentity.com/v1/tenants/${tenantId}/realms/${realm.id}/identities`,
  {
    method: "POST",
    body: `{
              "identity": {
                "display_name": "BI Quickstart Identity",
                "traits": {
                  "type": "traits_v0",
                  "username": "${userName}",
                  "primary_email_address": "${email}"
                }
              }
            }`,
    headers: {
      Authorization: "Bearer " + apiToken,
      "content-type": "application/json",
    },
  }
)
  .then((result) => {
    if (result.ok) {
      return result.json();
    } else {
      if (result.status == 409) {
        throw new ApiError(
          result.status,
          `User already exists. Choose another username`
        );
      }
      throw new ApiError(
        result.status,
        `POST request to create identity returned a ${result.status}`
      );
    }
  })
  .then((identityJson) => {
    console.log(`created identity with id: ${identityJson.id}`);
    //CREATE PASSKEY (binding job) and trigger email
    return fetch(
      `https://api-us.beyondidentity.com/v1/tenants/${identityJson.tenant_id}/realms/${identityJson.realm_id}/identities/${identityJson.id}/credential-binding-jobs`,
      {
        method: "POST",
        body: `{
                  "job": {
                    "delivery_method": "EMAIL",
                    "post_binding_redirect_uri": "http://localhost:3000",
                    "authenticator_config_id": "${authenticatorConfigId}"
                  }
                }`,
        headers: {
          Authorization: "Bearer " + apiToken,
          "content-type": "application/json",
        },
      }
    );
  })
  .then((result) => {
    if (result.ok) {
      return result.json();
    } else {
      if (result.status == 409) {
        throw new ApiError(
          result.status,
          `User already exists. Choose another username`
        );
      }
      throw new ApiError(
        result.status,
        `POST request to create a credential binding job returned a ${result.status}`
      );
    }
  })
  .then((jobJson) => {
    console.log(`created credential binding job with id: ${jobJson.id}`);
    return jobJson;
  })
  .catch((err) => {
    console.log(err.message);
    if (err.code !== null) {
      return err;
    } else {
      return err;
    }
  });
```
